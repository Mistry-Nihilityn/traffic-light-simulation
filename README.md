# 嵌入式交通灯控制系统

## 项目简介

这是一个基于S3C6410处理器的嵌入式交通灯模拟控制系统，暨**合肥工业大学软件学院23级嵌入式软件开发大作业**，实现了一个完整的嵌入式系统从启动到应用程序运行的完整流程。项目包含启动代码、硬件驱动、中断处理和应用程序逻辑，展示了嵌入式系统开发的核心技术。

## 项目功能

- **交通灯模拟**：控制LED灯模拟路口交通灯状态
- **多模式控制**：支持三种不同的交通灯时间模式
- **实时按键响应**：通过轮询机制实现毫秒级按键响应
- **多模态反馈**：提供LED闪烁和蜂鸣器鸣叫两种反馈方式
- **完整启动流程**：实现从NAND Flash启动、代码重定位到SDRAM执行

## 硬件平台

- **处理器**：Samsung S3C6410 ARM11
- **内存**：DDR SDRAM
- **存储**：NAND Flash
- **外设**：4个LED灯、4个按键开关、有源蜂鸣器
- **开发板**：基于S3C6410的核心板及扩展板

## 项目结构

```
timer-project/
├── Makefile                    # 构建主脚本
├── makefile                    # 备用构建脚本（与Makefile相同）
├── timer.lds                   # 链接脚本，定义内存布局
├── start.S                     # ARM汇编启动代码
├── main.c                      # 主应用程序
├── common.h                    # 公共定义和寄存器操作宏
├── buzzer.c                    # 蜂鸣器驱动
├── buzzer.h                    # 蜂鸣器头文件
├── clock.c                     # 系统时钟初始化
├── sdram.c                     # SDRAM内存控制器初始化
├── nand.c                      # NAND Flash控制器初始化
├── timer.c                     # 定时器和中断处理
├── uart.c                      # 串口通信驱动（未使用）
├── include/                    # 头文件目录
│   ├── types.h                 # 数据类型定义
│   ├── stdio.h                 # 标准IO函数声明
│   ├── string.h                # 字符串函数声明（未使用）
│   ├── ctype.h                 # 字符类型函数（未使用）
│   ├── kernel.h                # 内核相关定义（未使用）
│   ├── gcclib.h                # GCC库定义（未使用）
│   └── system.h                # 系统相关定义（未使用）
└── lib/                        # 库文件目录（在Makefile中引用）
    └── ...                     # 标准C库的轻量级实现
```

## 快速开始

### 1. 克隆仓库

```bash
git clone https://github.com/[your-username]/timer-project.git
cd timer-project
```

### 2. 构建项目

```bash
make clean      # 清理之前的构建文件
make            # 编译项目
```

编译成功后，将生成以下文件：
- `timer.bin` - 可烧录的二进制文件
- `timer.elf` - ELF格式的可执行文件
- `timer.dis` - 反汇编文件，用于调试

### 3. 烧录到开发板

使用相应的烧录工具将`timer.bin`烧录到开发板的NAND Flash中，然后重启开发板。

## 使用说明

### 按键功能

| 按键 | 功能 | 反馈 |
|------|------|------|
| **K1** | 设置亮灯时间为2秒 | LED闪烁2次（2秒间隔） |
| **K2** | 设置亮灯时间为1秒 | 蜂鸣器鸣叫2次（1秒间隔） |
| **K3** | 设置南北向绿灯0.5秒，东西向绿灯2秒 | LED闪烁3次 + 蜂鸣器长鸣1次 |
| **K4** | 应用新设置 | 交通灯按新参数开始运行 |

### 交通灯状态

系统支持三种工作模式：

1. **默认模式**：南北/东西向绿灯各亮1秒，闪烁3次
2. **模式1**：南北/东西向绿灯各亮2秒，闪烁3次
3. **模式2**：南北/东西向绿灯各亮1秒，闪烁3次
4. **模式3**：南北向绿灯亮0.5秒，东西向绿灯亮2秒，各闪烁3次

### LED对应关系

| LED | 代表方向 | 颜色 |
|-----|----------|------|
| LED1 | 东西向绿灯 | 绿色 |
| LED2 | 东西向红灯 | 绿色 |
| LED3 | 南北向绿灯 | 绿色 |
| LED4 | 南北向红灯 | 绿色 |

## 系统架构

### 启动流程
1. CPU复位，执行`start.S`中的汇编代码
2. 关闭看门狗，初始化系统时钟
3. 初始化SDRAM控制器
4. 初始化NAND Flash控制器
5. 配置中断系统
6. 代码重定位到SDRAM
7. 清空BSS段，跳转到`main()`函数

### 中断处理
- 定时器0配置为1秒周期中断
- 中断服务程序`do_irq()`处理状态更新和反馈
- 采用非嵌套中断设计，简化处理逻辑

### 状态管理
- 基于时间触发的有限状态机
- 状态包括：南北绿灯亮、南北绿灯闪烁、东西绿灯亮、东西绿灯闪烁
- 按键反馈作为高优先级状态

## 代码解析

### 关键模块

1. **启动模块** (`start.S`)
   - 硬件初始化的低级操作
   - 中断向量表设置
   - 代码重定位逻辑

2. **中断处理模块** (`timer.c`)
   - 定时器初始化和配置
   - 中断服务程序实现
   - 状态机和反馈处理

3. **硬件驱动模块**
   - `clock.c` - 系统时钟配置
   - `sdram.c` - DDR内存初始化
   - `nand.c` - Flash读写操作
   - `buzzer.c` - 蜂鸣器控制

4. **应用程序模块** (`main.c`)
   - 主循环按键检测
   - 模式设置和应用
   - 系统初始化协调

## 致谢

- 感谢合肥工业大学软件学院嵌入式课程的教学指导
- 感谢所有开源嵌入式项目的启发和参考
- 
